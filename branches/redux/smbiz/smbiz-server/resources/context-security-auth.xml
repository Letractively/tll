<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd">

	<description>
		Application context containing authentication beans.
	</description>

	<!-- ~~~~~~~~~~~~~~~~~~ "BEFORE INVOCATION" AUTHORIZATION DEFINITIONS ~~~~~~~~~~~~~~~~ -->

	<!-- ACL permission masks used by this application -->
	<bean id="org.acegisecurity.acl.basic.SimpleAclEntry.ADMINISTRATION"
		class="org.springframework.beans.factory.config.FieldRetrievingFactoryBean">
		<property name="staticField">
			<value>
				org.acegisecurity.acl.basic.SimpleAclEntry.ADMINISTRATION
			</value>
		</property>
	</bean>

	<bean id="org.acegisecurity.acl.basic.SimpleAclEntry.READ"
		class="org.springframework.beans.factory.config.FieldRetrievingFactoryBean">
		<property name="staticField">
			<value>
				org.acegisecurity.acl.basic.SimpleAclEntry.READ
			</value>
		</property>
	</bean>
	<bean id="org.acegisecurity.acl.basic.SimpleAclEntry.DELETE"
		class="org.springframework.beans.factory.config.FieldRetrievingFactoryBean">
		<property name="staticField">
			<value>
				org.acegisecurity.acl.basic.SimpleAclEntry.DELETE
			</value>
		</property>
	</bean>

	<!-- An access decision voter that reads ROLE_* configuration settings -->
	<bean id="roleVoter" class="org.acegisecurity.vote.RoleVoter" />

	<bean id="aclAccountRelatedVoter"
		class="com.tll.service.acl.AccountRelatedBasicAclEntryVoter"
		abstract="true">
		<property name="aclManager">
			<ref local="aclManager" />
		</property>
		<property name="requirePermission">
			<list>
				<ref
					local="org.acegisecurity.acl.basic.SimpleAclEntry.ADMINISTRATION" />
				<ref
					local="org.acegisecurity.acl.basic.SimpleAclEntry.READ" />
			</list>
		</property>
	</bean>

	<!-- An access decision voter that reads ACL_ACCOUNT_RELATED_READ configuration settings -->
	<bean id="aclAccountRelatedReadVoter"
		class="com.tll.service.acl.AccountRelatedBasicAclEntryVoter"
		parent="aclAccountRelatedVoter">
		<property name="processConfigAttribute">
			<value>ACL_ACCOUNT_RELATED_READ</value>
		</property>
	</bean>

	<!-- An access decision voter that reads ACL_ACCOUNT_RELATED_DELETE configuration settings -->
	<bean id="aclAccountRelatedDeleteVoter"
		class="com.tll.service.acl.AccountRelatedBasicAclEntryVoter"
		parent="aclAccountRelatedVoter">
		<property name="processConfigAttribute">
			<value>ACL_ACCOUNT_RELATED_DELETE</value>
		</property>
	</bean>

	<!-- An access decision voter that reads ACL_ACCOUNT_ADMIN configuration settings -->
	<!-- 
		<bean id="aclAccountAdminVoter" class="org.acegisecurity.vote.BasicAclEntryVoter">
		<property name="processConfigAttribute"><value>ACL_ACCOUNT_ADMIN</value></property>
		<property name="processDomainObjectClass"><value>com.tll.model.impl.Account</value></property>
		<property name="aclManager"><ref local="aclManager"/></property>
		<property name="requirePermission">
		<list>
		<ref local="org.acegisecurity.acl.basic.SimpleAclEntry.ADMINISTRATION"/>
		</list>
		</property>
		</bean>
	-->

	<!-- An access decision manager used by the business objects -->
	<bean id="accountAccessDecisionManager"
		class="org.acegisecurity.vote.AffirmativeBased">
		<property name="allowIfAllAbstainDecisions">
			<value>false</value>
		</property>
		<property name="decisionVoters">
			<list>
				<ref local="roleVoter" />
				<ref local="aclAccountRelatedReadVoter" />
				<ref local="aclAccountRelatedDeleteVoter" />
				<!-- <ref local="aclAccountAdminVoter"/> -->
			</list>
		</property>
	</bean>

	<!-- ========= ACCESS CONTROL LIST LOOKUP MANAGER DEFINITIONS ========= -->

	<bean id="aclManager"
		class="org.acegisecurity.acl.AclProviderManager">
		<property name="providers">
			<list>
				<ref
					local="com.tll.service.acl.AccountRelatedAclProviderManager" />
			</list>
		</property>
	</bean>

	<bean id="com.tll.service.acl.AccountRelatedAclProviderManager"
		class="com.tll.service.acl.AccountRelatedAclProviderManager">
		<property name="basicAclDao">
			<ref bean="com.tll.dao.impl.IAclDao" />
		</property>
	</bean>

	<!-- ============== "AFTER INTERCEPTION" AUTHORIZATION DEFINITIONS =========== -->

	<bean id="afterInvocationManager"
		class="com.tll.service.acl.afterinvocation.AfterInvocationProviderManager">
		<property name="providers">
			<list>
				<ref local="afterAclRead" />
				<ref local="afterAclFilterer" />
			</list>
		</property>
	</bean>

	<!-- Processes AFTER_ACL_FILTERER configuration settings -->
	<bean id="afterAclFilterer"
		class="com.tll.service.acl.afterinvocation.BasicAclEntryAfterInvocationFilteringProvider">
		<property name="processConfigAttribute">
			<value>AFTER_ACL_FILTERER</value>
		</property>
		<property name="aclManager">
			<ref local="aclManager" />
		</property>
		<property name="requirePermission">
			<list>
				<ref
					local="org.acegisecurity.acl.basic.SimpleAclEntry.ADMINISTRATION" />
				<ref
					local="org.acegisecurity.acl.basic.SimpleAclEntry.READ" />
			</list>
		</property>
		<property name="filtererFactory"
			ref="com.tll.service.acl.afterinvocation.FiltererFactory" />
	</bean>

	<!-- Processes AFTER_ACL_READ configuration settings -->
	<bean id="afterAclRead"
		class="org.acegisecurity.afterinvocation.BasicAclEntryAfterInvocationProvider">
		<property name="processConfigAttribute">
			<value>AFTER_ACL_READ</value>
		</property>
		<property name="aclManager">
			<ref local="aclManager" />
		</property>
		<property name="requirePermission">
			<list>
				<ref
					local="org.acegisecurity.acl.basic.SimpleAclEntry.ADMINISTRATION" />
				<ref
					local="org.acegisecurity.acl.basic.SimpleAclEntry.READ" />
			</list>
		</property>
	</bean>

	<bean id="com.tll.service.acl.afterinvocation.FiltererFactory"
		class="com.tll.service.acl.afterinvocation.FiltererFactory">
		<!-- 
		<property name="mapFiltererTransformers">
			<list>
				<bean
					class="com.tll.service.scheduler.bid.BidScheduleMapCollectionTransformer" />
			</list>
		</property>
		-->
	</bean>

	<!-- ================= METHOD INVOCATION AUTHORIZATION ==================== -->

	<!-- 
		ACCOUNT SECURITY
	-->
	<bean id="accountSecurity"
		class="org.acegisecurity.intercept.method.aopalliance.MethodSecurityInterceptor">
		<property name="authenticationManager">
			<ref bean="authenticationManager" />
		</property>
		<property name="accessDecisionManager">
			<ref local="accountAccessDecisionManager" />
		</property>
		<property name="afterInvocationManager">
			<ref local="afterInvocationManager" />
		</property>
		<property name="objectDefinitionSource">
			<value>
				com.tll.service.IListHandlerSupport.getEntitiesFromIds=ROLE_USER,ROLE_ADMINISTRATOR,AFTER_ACL_FILTERER
				com.tll.service.IListHandlerSupport.getPage*=ROLE_USER,ROLE_ADMINISTRATOR,AFTER_ACL_FILTERER
				com.tll.service.IListHandlerSupport.findByCriteria=ROLE_USER,ROLE_ADMINISTRATOR,AFTER_ACL_FILTERER

				com.tll.service.IEntityService.loadByIds=ROLE_USER,ROLE_ADMINISTRATOR,AFTER_ACL_FILTERER
				com.tll.service.IEntityService.loadAll=ROLE_USER,ROLE_ADMINISTRATOR,AFTER_ACL_FILTERER
				com.tll.service.IEntityService.load=ROLE_USER,ROLE_ADMINISTRATOR,AFTER_ACL_READ
				com.tll.service.IEntityService.persist=ACL_ACCOUNT_RELATED_READ
				com.tll.service.IEntityService.persistAll=ACL_ACCOUNT_RELATED_READ
				com.tll.service.IEntityService.purge=ACL_ACCOUNT_RELATED_DELETE
				com.tll.service.IEntityService.purgeAll=ACL_ACCOUNT_RELATED_DELETE

				com.tll.service.IStatefulEntityService.delete=ACL_ACCOUNT_RELATED_DELETE
				com.tll.service.IStatefulEntityService.deleteAll=ACL_ACCOUNT_RELATED_DELETE
			</value>
		</property>
	</bean>

</beans>
